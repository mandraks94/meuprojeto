<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player com Cast</title>
  
    <!-- Google Cast SDK -->
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 30px;
      }
      video {
        width: 100%;
        height: auto;
        max-width: 600px;
        margin-top: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }
      .cast-button-container {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }
    </style>
  </head>
<body>

  <h1>Minha Live</h1>

  <!-- Botão de Cast -->
  <div class="cast-button-container">
    <google-cast-launcher style="height: 48px; width: 48px;"></google-cast-launcher>
  </div>

  <!-- Player de vídeo -->
  <video id="video" controls autoplay></video>

  <!-- HLS.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    var video = document.getElementById('video');
    var videoSrc = 'https://sae11.playlist.live-video.net/v1/playlist/Cv8FXnISTVehHEM4plRSSu2LcxObO5OHnsfsfP5kCVDikrBLWo2FQAkxEwGUhhnE8muzq7-cpduU-jqIEWgAwi-X5UHWKe17lfOofXJ3Hci5ofF0bPVy-AlSkN9cTx_F2eaJfQD-L3Qhx8XPZ1IDKLUZ42NiZOHHirf4j53BugyCi2ugOGH4-oxXwJuLF9JH3yisWZwmpgbX2rI88IO9jypEg66fKFczgofUeYC354WsBZUQSQlcBPszP8G14L1vsVvXfBJ7ClHLDt7vYvGulSgk9E44ZGRrEXLu9I_D0f9UN1yRgppLU3e4T9N0bnHZXHA5wsnBVvSuzmBlI5FdCMth6JW3JDRXG7Dt8W0M2QBxTWErNyebqbcrTB1h3tNqIWU4yUN2DyOldHtUY6MW0Hg3r_bOPI258JVpgt1AUdVw2-JpaaFvTT_SDW42NsMtcyc7gh6WXZecenA6zq-0NDHHrqvyp3z3DOSfsgb_4tehEj6hg82wfyDf_sJJYl49ax596w-_CRkggK52RHnzl6V13VpOm1Kjw_ROr77dGAHC0T05zv2Ouamm39bWMp01DwgA7e9ZhjPO3UypK4atBtmCYutsMr2PX9HUAdymBU3guOyZ3JM27ifiiP3ZQwFvrvdeASvcs0FhAMIV-irStF-M4JhscQCAeXNGErw9gVhiUTLHkTMYGGmNhAb9Opvej_o-V2DTMSZL7cWfQLImXY6vptPBMNajkDHvraurUEAajJFhXOJ-LTlCJXoFFBFpglFXhh2MnUFjowJSt57m4O2z8rw4vc2Vh2lRodzTXafKMcqST3CjKNgJ-ypowSQAqO3knb4bfsQyCSUyzMiNREbTvr5LssS5LU-Mb-ye2qiy2hPfvXk9bsq6VlXav4-R64z321LyMena6SgWzxA5SEvmryAlF5Py2t0BnJLIZj0RAeE0Sd5jk_KRh754PDvKzr3aOEHuKH4Gy0q29Amku-MT3mbpk8LZdnX67ojGaBP-vDDxmCnBHH5m2CLpUMbtgrAaDEAwbFPEkrMZnp7KoiABKgl1cy1lYXN0LTIwkQw.m3u8'; // Troque pelo seu link!

    // Função para carregar o vídeo normal (localmente no navegador)
    function loadVideoLocally() {
      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
        video.addEventListener('loadedmetadata', function() {
          video.play();
        });
      }
    }

    // Inicializa o Cast
    window['__onGCastApiAvailable'] = function(isAvailable) {
      if (isAvailable) {
        const context = cast.framework.CastContext.getInstance();
        context.setOptions({
          receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
          autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
        });

        // Evento: quando inicia ou para o cast
        context.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED, function(event) {
          switch (event.sessionState) {
            case cast.framework.SessionState.SESSION_STARTED:
            case cast.framework.SessionState.SESSION_RESUMED:
              loadVideoOnChromecast();
              break;
            case cast.framework.SessionState.SESSION_ENDED:
              loadVideoLocally(); // Quando sair do cast, volta a tocar local
              break;
          }
        });
      }
    };

    // Envia o vídeo para o Chromecast
    function loadVideoOnChromecast() {
      const castSession = cast.framework.CastContext.getInstance().getCurrentSession();
      const mediaInfo = new chrome.cast.media.MediaInfo(videoSrc, 'application/vnd.apple.mpegurl');

      const request = new chrome.cast.media.LoadRequest(mediaInfo);
      castSession.loadMedia(request).then(
        function() { console.log('Transmissão iniciada'); },
        function(errorCode) { console.log('Erro ao transmitir: ' + errorCode); }
      );
    }

    // Começar carregando localmente
    loadVideoLocally();
  </script>

</body>
</html>